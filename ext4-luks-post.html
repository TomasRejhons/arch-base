#!/bin/bash

NEWHOSTNAME=archblue
NEW_USER_NAME=tomas

echo "---------------------------------------------"
echo "CREATE SWAPFILE"
echo "---------------------------------------------"

fallocate -l 8GB /swapfile
sleep 1
chmod 600 /swapfile
sleep 1
mkswap /swapfile
sleep 1
swapon /swapfile
sleep 1
echo "/swapfile none swap sw 0 0" >> /etc/fstab
sleep 1
vim /etc/fstab
sleep 1

echo "---------------------------------------------"
echo "ORDINARY BORING SETUP"
echo "---------------------------------------------"

ln -sf /usr/share/zoneinfo/Europe/Prague /etc/localtime
sleep 1
hwclock --systohc
sleep 1
vim /etc/locale.gen
sleep 1
locale-gen
sleep 1
echo "LANG=en_US.UTF-8" >> /etc/locale.conf
echo "$NEWHOSTNAME" >> /etc/hostname
echo "127.0.0.1 localhost" >> /etc/hosts
echo "::1 localhost" >> /etc/hosts
echo "127.0.1.1 $NEWHOSTNAME.localdomain $NEWHOSTNAME" >> /etc/hosts

echo "---------------------------------------------"
echo "ROOT PASSWD"
echo "---------------------------------------------"

passwd
sleep 1

echo "---------------------------------------------"
echo "INSTALL ADDITIONAL TOOLS"
echo "---------------------------------------------"

pacman -S grub \
          efibootmgr \
          networkmanager \
          network-manager-applet \
          wireless_tools \
          wpa_supplicant \
          dialog \
          os-prober \
          mtools \
          dosfstools \
          base-devel \
          linux-headers \
          dhcpcd

sleep 1

echo "---------------------------------------------"
echo "CONFIGURE BOOTLOADER"
echo "---------------------------------------------"

# GRUB_CMDLINE_LINUX="cryptdevice=/dev/disk/by-partlabel/cryptsystem:archsystem"
vim /etc/default/grub
sleep 1
#HOOKS=... block encrypt filesystem ...
vim /etc/mkinitcpio.conf
sleep 1
mkinitcpio -p linux
sleep 1
grub-install --target=x86_64-efi --efi-directory=/boot/EFI --bootloader-id=ARCHGRUB
sleep 1
grub-mkconfig -o /boot/grub/grub.cfg
sleep 1

echo "---------------------------------------------"
echo "CREATE USER"
echo "---------------------------------------------"

useradd -mG wheel,audio,video,optical,storage $NEW_USER_NAME
sleep 1

echo "---------------------------------------------"
echo "USER PASSWORD"
echo "---------------------------------------------"

passwd $NEW_USER_NAME
sleep 1
EDITOR=nvim visudo
sleep 1

echo "---------------------------------------------"
echo "DOWNLOADING ARCH-DI SCRIPT"
echo "---------------------------------------------"

wget archdi.sf.net/archdi

echo "---------------------------------------------"
echo "DON'T FORGET TO exit, umount -a and reboot !!!"
echo "---------------------------------------------"

